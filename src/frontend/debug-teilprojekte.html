<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Teilprojekte Laden</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ğŸ”§ DEBUG: Teilprojekte Laden</h1>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ§ª Tests</h2>
            <div class="space-y-2">
                <button onclick="testAPI()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    1. API Testen
                </button>
                <button onclick="testDOM()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 ml-2">
                    2. DOM Testen
                </button>
                <button onclick="simulateLoad()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700 ml-2">
                    3. Simulation
                </button>
            </div>
            <div id="debugOutput" class="mt-4 p-4 bg-gray-50 rounded text-sm font-mono"></div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow mb-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ Teilprojekte Container</h2>
            <div id="teilprojekteContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4 min-h-[200px] border-2 border-dashed border-gray-300 p-4">
                <div class="text-center py-8 text-gray-500">
                    Container ist leer - warte auf Daten...
                </div>
            </div>
        </div>
        
        <div class="bg-white p-6 rounded-lg shadow">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š Console Log</h2>
            <div id="consoleLog" class="bg-black text-green-400 p-4 rounded text-sm font-mono h-64 overflow-auto"></div>
        </div>
    </div>

    <script>
        // Console Log Capture
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        const logContainer = document.getElementById('consoleLog');
        
        function addToLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'text-red-400' : type === 'warn' ? 'text-yellow-400' : 'text-green-400';
            logContainer.innerHTML += `<div class="${color}">[${timestamp}] ${type.toUpperCase()}: ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog('log', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToLog('error', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog('warn', args.join(' '));
        };
        
        function debug(message) {
            const debugDiv = document.getElementById('debugOutput');
            debugDiv.innerHTML += `<div class="mb-2">${new Date().toLocaleTimeString()}: ${message}</div>`;
            console.log(message);
        }
        
        async function testAPI() {
            debug('ğŸ” Teste API...');
            
            try {
                const response = await fetch('/api/teilprojekte');
                debug(`âœ… Response Status: ${response.status} ${response.statusText}`);
                
                const data = await response.json();
                debug(`ğŸ“¦ Response Data: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success && data.data) {
                    debug(`ğŸ“Š Teilprojekte gefunden: ${data.data.length}`);
                    return data.data;
                } else {
                    debug('âŒ Keine validen Daten in Response');
                    return null;
                }
                
            } catch (error) {
                debug(`âŒ API Fehler: ${error.message}`);
                return null;
            }
        }
        
        function testDOM() {
            debug('ğŸ” Teste DOM...');
            
            const container = document.getElementById('teilprojekteContainer');
            if (!container) {
                debug('âŒ Container "teilprojekteContainer" nicht gefunden!');
                return false;
            }
            
            debug('âœ… Container gefunden');
            debug(`ğŸ“¦ Container classList: ${container.classList.toString()}`);
            debug(`ğŸ“¦ Container innerHTML length: ${container.innerHTML.length}`);
            
            return true;
        }
        
        async function simulateLoad() {
            debug('ğŸš€ Simuliere loadTeilprojekteFromDatabase...');
            
            // Test DOM
            if (!testDOM()) return;
            
            // Test API
            const teilprojekte = await testAPI();
            if (!teilprojekte) return;
            
            // Test Display Function
            debug('ğŸ¨ Teste displayTeilprojekte...');
            displayTeilprojekte(teilprojekte);
        }
        
        function displayTeilprojekte(teilprojekte) {
            debug(`ğŸ¨ displayTeilprojekte gestartet mit ${teilprojekte.length} Teilprojekten`);
            
            const container = document.getElementById('teilprojekteContainer');
            if (!container) {
                debug('âŒ Container nicht gefunden in displayTeilprojekte!');
                return;
            }

            if (!teilprojekte || teilprojekte.length === 0) {
                debug('âš ï¸ Keine Teilprojekte zum Anzeigen');
                container.innerHTML = '<div class="text-center py-8 text-gray-500">Keine Teilprojekte gefunden</div>';
                return;
            }

            debug('ğŸ”¨ Erstelle HTML fÃ¼r Teilprojekte...');
            
            try {
                const html = teilprojekte.map(tp => {
                    debug(`ğŸ“ Erstelle Karte fÃ¼r: ${tp.name}`);
                    return `
                        <div class="bg-white p-6 rounded-lg shadow-sm border">
                            <h3 class="text-lg font-semibold mb-4">${tp.name}</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Budget:</span>
                                    <span class="font-semibold">CHF ${parseFloat(tp.budget || 0).toLocaleString()}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Beschreibung:</span>
                                    <p class="text-sm text-gray-700 mt-1">${tp.beschreibung || 'Keine Beschreibung verfÃ¼gbar'}</p>
                                </div>
                                <div>
                                    <span class="text-gray-600">Kategorie:</span>
                                    <span class="text-sm text-gray-700">${tp.kategorie || 'Allgemein'}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Status:</span>
                                    <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">${tp.status}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                debug(`âœ… HTML erstellt (${html.length} Zeichen)`);
                container.innerHTML = html;
                debug(`âœ… Container innerHTML gesetzt`);
                
            } catch (error) {
                debug(`âŒ Fehler beim Erstellen der HTML: ${error.message}`);
            }
        }
        
        // Auto-start when page loads
        document.addEventListener('DOMContentLoaded', function() {
            debug('ğŸš€ Debug-Seite geladen');
            console.log('Debug-Seite bereit fÃ¼r Tests');
        });
    </script>
</body>
</html>
